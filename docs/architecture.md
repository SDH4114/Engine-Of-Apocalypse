# Engine Of Apocalypse – Архитектура

## Цели
- Модульная среда выполнения (Runtime), отделенная от инструментов редактора.
- Минимизация аллокаций памяти (zero-allocation там, где возможно) в горячих путях кода.
- Кроссплатформенность: единый код для Windows, macOS и Linux.

## Технологический стек (Milestone 1)
- **Платформа/Ввод**: SDL2 (через `Veldrid.StartupUtilities` и нативные привязки).
- **Графика**: Veldrid 4.9.0 (абстракция над Vulkan, Metal, Direct3D 11, OpenGL).
- **Сериализация**: Newtonsoft.Json 13.0.3 (для конфигов и данных).
- **Среда**: .NET 10.

## Модульная структура

### 1. `EoA.Core`
Базовый модуль. Содержит только интерфейсы и структуры данных.
*   **Ответственность**: Определение контрактов (`IGame`, `IEngineHost`), конфигурации, базовых типов (`Color`, `FrameTime`).
*   **Зависимости**: Нет.

### 2. `EoA.Platform`
Модуль платформы.
*   **Ответственность**: Инициализация окна (SDL2), создание графического устройства (Veldrid), управление основным циклом (Main Loop).
*   **Детали реализации**:
    *   Создает окно с параметрами из `EngineConfig`.
    *   Настраивает `GraphicsDevice` с поддержкой буфера глубины (`D32_Float_S8_UInt`) и VSync.
    *   Управляет таймингом кадра и вызывает методы `IGame`.
*   **Зависимости**: `EoA.Core`, `EoA.Graphics`, Veldrid, SDL2.

### 3. `EoA.Graphics`
Модуль рендеринга.
*   **Ответственность**: Абстракция над низкоуровневым графическим устройством. Предоставляет упрощенный контекст (`GraphicsDeviceContext`) для игры.
*   **Детали реализации**:
    *   Управляет `CommandList` для отрисовки.
    *   Реализует очистку экрана (`Clear`) и смену буферов (`Present`).
*   **Зависимости**: `EoA.Core`, Veldrid.

### 4. `EoA.SampleGame`
Пример реализации игры.
*   **Ответственность**: Демонстрация работы движка. Просто очищает экран заданным цветом.
*   **Зависимости**: `EoA.Core`, `EoA.Platform`.

## Поток выполнения (Runtime Loop)

1.  **Bootstrap**: `Program.cs` создает `EngineConfig` и экземпляр игры (`SampleGame`), затем передает их в `EngineHost`.
2.  **Инициализация**: `EngineHost` создает окно, графическое устройство и вызывает `IGame.Initialize`.
3.  **Цикл (Loop)**:
    *   Обработка системных событий (ввод, изменение размера окна).
    *   Расчет дельты времени (`FrameTime`).
    *   `IGame.Update(frameTime)`: Логика игры.
    *   `IGame.Render(frameTime)`: Формирование команд отрисовки.
    *   `GraphicsDevice.SwapBuffers()`: Отображение кадра.
4.  **Завершение**: При закрытии окна вызывается `IGame.Shutdown` и освобождаются ресурсы.
